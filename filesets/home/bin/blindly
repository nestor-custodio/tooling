#! /bin/env bash
source '/home/nestor/bin/std.lib'

# ---

{ # -- Help Text -- #

	cat <<-EOF | store-as usage
		Usage: $( script-name ) [ COMMAND [-- ARGS] ]

		Runs the given COMMAND (passing along any ARGS given) in the background,
		with no HUP action and no PID reported into the console upon completion.

		To allow for complex scripts (multi-line items and commands with quotes,
		pipes, and/or redirects), the script to run can also be passed via STDIN.


		Mandatory arguments to long options are mandatory for short options too.
		  --help                    Show this help text.


		Exit Status:
		  0  if OK,
		  1  if invalid option.
	EOF

}

# ---

{ # -- Parameter Processing: Options -- #

	# Set defaults.

	CHAR_OPTS=''
	LONG_OPTS='help'

	set-params
	while true; do
		option="$1" && shift
		case "$option" in
			(--help) exit-out "$usage" ;;
			(--) break ;;  # No more options.
		esac
	done

}

# ---
# ---


tempname | store-as executable


# Prime the runner.
#
cat <<-EOF > "$executable"
	#! /bin/env bash
	trap 'rm -f "${executable}"' EXIT
EOF

# Drop in the given command(s).
#
if [ "$#" == 0 ]
	then cat >> "$executable"
	else echo "${@@Q}" >> "$executable"
fi


# Run it!
#
chmod +x "$executable"
nohup "$executable" &> /dev/null &
